{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-11-15/","result":{"data":{"site":{"siteMetadata":{"title":"AnyFer üê¶"}},"markdownRemark":{"id":"d84c95cf-5f8b-5711-adc9-8b047faa4291","excerpt":"Using Quick and Nimble is a great support for your BDD code, but keep in mind they are just tools, and all of this can be written in XCTest. Use tools as tools‚Ä¶","html":"<p>Using Quick and Nimble is a great support for your BDD code, but keep in mind they are just tools, and all of this can be written in XCTest. Use tools as tools, really. And pay attention to the attitude BDD encourages you to take.</p>\n<h1>Introduction</h1>\n<p>Apart from the intended pun in the title, BDD in iOS is a way to work faster. Or maybe not much faster, but keeping a constant pace in iOS development, a way of achieving painless development. In this article, I‚Äôll talk to you about Behavior Driven Development, a quick theoric introduction to it, and a hands-on demonstration using Quick and Nimble in a few typical scenarios. Let‚Äôs get started.</p>\n<h1>Agenda</h1>\n<ul>\n<li>What is BDD?</li>\n<li>How is BDD related to TDD?</li>\n<li>The problem with XCTest syntax</li>\n<li>Quick (and Nimble) to the rescue!</li>\n<li>Extending Nimble</li>\n<li>Conclusion</li>\n</ul>\n<h1>What is BDD?</h1>\n<p>According to <a href=\"https://cucumber.io/docs/bdd/\">Cucumber docs</a>, BDD is ‚Äúa way for software teams to work that closes the gap between business people and technical people [‚Ä¶] We do this by focusing collaborative work around concrete, real-world examples that illustrate how we want the system to behave.‚Äù</p>\n<p>So, in more concrete way:</p>\n<ul>\n<li>We start from the acceptance criteria we define in our user stories.</li>\n<li>We define real world examples in the acceptance criteria using the template ‚ÄúGiven [initial state] when [event] then [final state]‚Äú.</li>\n<li>We tipically use a DSL to enable translate the acceptance criteria to machine executable code.</li>\n</ul>\n<h1>How is BDD related to TDD?</h1>\n<p>BDD and TDD are similar in the sense that both of them start by defining the expected result and how to test that expected result is achieved even before writing any code. The difference is in <strong>how they define the expected result</strong>.</p>\n<p>In TDD we write tests like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">test_userHasBeenSaved</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// Arrange</span>\n\t<span class=\"token keyword\">let</span> userRepository <span class=\"token operator\">=</span> <span class=\"token function\">UserRepository</span><span class=\"token punctuation\">(</span>mode<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>inMemory<span class=\"token punctuation\">)</span>\n\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">populateTestUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">let</span> currentUsersCount <span class=\"token operator\">=</span> usersRepository<span class=\"token punctuation\">.</span>currentCount\n\n\t<span class=\"token comment\">// Act</span>\n\t<span class=\"token keyword\">let</span> user <span class=\"token operator\">=</span> <span class=\"token function\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tuser<span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> <span class=\"token string\">\"user.test@sampleemail.com\"</span>\n\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\">// Assert</span>\n\t<span class=\"token function\">XCTAssertEqual</span><span class=\"token punctuation\">(</span>\n\t\tusersRepository<span class=\"token punctuation\">.</span>currentCount<span class=\"token punctuation\">,</span> \n\t\tcurrentUsersCount <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"The users count should have increased in one.\"</span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That is a typical test in TDD. We follow the structure <code class=\"language-text\">Arrange - Act - Assert</code>, by creating our initial setuo (Arrange), then execute an action (Act), and finally checking if the final state is the one that we are expecting to be (Assert).</p>\n<p>In BDD, the process is similar, but <strong>we are focusing on the application behavior instead of the objects state</strong>.</p>\n<p>Let‚Äôs check the sample example using a BDD approach:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">test_userHasBeenSaved</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// Arrange</span>\n\t<span class=\"token keyword\">let</span> userRepository <span class=\"token operator\">=</span> <span class=\"token function\">UserRepository</span><span class=\"token punctuation\">(</span>mode<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>inMemory<span class=\"token punctuation\">)</span>\n\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">populateTestUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\">// Act</span>\n\t<span class=\"token keyword\">let</span> user <span class=\"token operator\">=</span> <span class=\"token function\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tuser<span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> <span class=\"token string\">\"user.test@sampleemail.com\"</span>\n\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\">// Assert</span>\n\t<span class=\"token function\">XCTAssertNotNil</span><span class=\"token punctuation\">(</span>\n\t\tusersRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">:</span> <span class=\"token string\">\"user.test@sampleemail.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"The user we have saved should be recoverable.\"</span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Disclaimer</strong>: This example has been extracted almost exactly from the <a href=\"https://github.com/Quick/Quick/blob/master/Documentation/en-us/BehavioralTesting.md\">Quick documentation</a>, which I highly recommend.</p>\n<h1>The problem with XCTest syntax</h1>\n<p>The previous example works, and can be used as it is. Even more, most people use it and it works for them. So, what is wrong with it? Shouldn‚Äôt we just use it and stop bothering?</p>\n<p>Well, if you are like me, and you suspect that there should be a better way of doing things, let me tell you a couple of things that could be improved.</p>\n<ol>\n<li>As BDD should be based on the acceptance criteria, and should be a methodology of interacting with business people, the XCTest syntax is more machine oriented than people oriented.</li>\n<li>It‚Äôs hard to describe different interrelated scenarios in XCTest. Let‚Äôs suppose you want to make the same test, but under different conditions. Doing that in XCTest is not the most pleasing experience, or at least it doesn‚Äôt feel natural.</li>\n<li>The tests start to make sense after you write them. This can feel like obvious, but it comes with a consequence: you need to actually write code in order to think the tests!</li>\n</ol>\n<p>Let me show you the solution üôå</p>\n<h1>Quick (and Nimble) to the rescue!</h1>\n<p>At a glance, this is how the previous test could be written in Quick/Nimble:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Given the User repository\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">var</span> userRepository<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UserRepository</span><span class=\"token operator\">!</span>\n\n\tbeforeEach <span class=\"token punctuation\">{</span>\n\t\tuserRepository <span class=\"token operator\">=</span> <span class=\"token function\">UserRepository</span><span class=\"token punctuation\">(</span>mode<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>inMemory<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token function\">context</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"When a user is saved\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tbeforeEach <span class=\"token punctuation\">{</span>\n\t\t\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">populateTestUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\t\t\t<span class=\"token keyword\">let</span> user <span class=\"token operator\">=</span> <span class=\"token function\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\tuser<span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> <span class=\"token string\">\"user.test@sampleemail.com\"</span>\n\t\t\tuserRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Should be recoverable\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">let</span> recoveredUser <span class=\"token operator\">=</span> usersRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span>\n\t\t\t\temail<span class=\"token punctuation\">:</span> <span class=\"token string\">\"user.test@sampleemail.com\"</span>\n\t\t\t<span class=\"token punctuation\">)</span>\n\t\t\t\n\t\t\t<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>recoveredUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toNot</span><span class=\"token punctuation\">(</span><span class=\"token function\">beNil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\t\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So, what is this:</p>\n<ol>\n<li>\n<p><strong>Quick</strong> is the library that provides the structure for these tests. It has three main functions:</p>\n<ol>\n<li><code class=\"language-text\">describe</code> is used to describe a module, or a function inside the module. It‚Äôs the topmost function you should add in your test. It‚Äôs the <strong>Given</strong> in the acceptance criteria.</li>\n<li><code class=\"language-text\">context</code> lets you describe a particular scenario for your module. It‚Äôs the <strong>When</strong> in the acceptance criteria.</li>\n<li><code class=\"language-text\">it</code> is finally used to describe a test case for the scenario. It‚Äôs the <strong>Then</strong> in the acceptance criteria.</li>\n</ol>\n</li>\n<li><strong>Quick</strong> also provides a <strong>beforeEach</strong> function and a <strong>afterEach</strong> function. They can be called at any level in the test, in order to be run before or after each of the sub-specs inside the scope.</li>\n<li>\n<p><strong>Nimble</strong> is the matcher that comes with <strong>Quick</strong>.</p>\n<ol>\n<li>Inside the <code class=\"language-text\">expect</code> function, you enter the element to match. If you want to know if a <code class=\"language-text\">sum</code> function works, when you could write something like <code class=\"language-text\">expect(sum(2 + 2))</code>.</li>\n<li>After you have the <code class=\"language-text\">expect</code> function configured, you need to match it against something. You do it by writing <code class=\"language-text\">.to(...)</code> or <code class=\"language-text\">.toNot(...)</code>.</li>\n<li>Finally, you set an expectation in the right side, inside the <code class=\"language-text\">to</code> / <code class=\"language-text\">toNot</code>.</li>\n<li>An example for the <code class=\"language-text\">sum</code> function would be <code class=\"language-text\">expect(sum(2 + 2)).to(equal(4))</code>.</li>\n</ol>\n</li>\n</ol>\n<p>Please, again, note that you can write all the <strong>Quick</strong> code without even writing any <strong>Nimble</strong> code.</p>\n<p>This code, for instance, is perfectly valid:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Given the User repository\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">context</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"When a user is saved\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Should be recoverable\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And it makes a lot of sense when you are talking to QA or business people and defining your feature.</p>\n<h1>Extending Nimble</h1>\n<p><strong>Nimble</strong> is a great tool. And what makes it even more amazing is the fact that you can extend it with custom matchers. Let‚Äôs explore the most basic way of writing custom matchers. Let‚Äôs suppose we want a matcher to check if a number is odd or even.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">beOdd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Predicate</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">Predicate</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span><span class=\"token punctuation\">.</span><span class=\"token function\">simple</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"be odd\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> actual <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> actual<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">PredicateStatus</span><span class=\"token punctuation\">(</span>bool<span class=\"token punctuation\">:</span> value <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">beEven</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Predicate</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">Predicate</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span><span class=\"token punctuation\">.</span><span class=\"token function\">simple</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"be even\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> actual <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> actual<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">PredicateStatus</span><span class=\"token punctuation\">(</span>bool<span class=\"token punctuation\">:</span> value <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Pretty simple, huh? </p>\n<p>Given an expression like <code class=\"language-text\">expect(EXPRESSION).to(PREDICATE)</code>, the generic parameter in the <code class=\"language-text\">Predicate&lt;T&gt;</code> is the expression type.</p>\n<p>In the example above, we are matching <code class=\"language-text\">Int</code> expressions against a simple test. The test in the example is simple, we just checking if the <code class=\"language-text\">EXPRESSION</code> is divisible by 2, but it can be much more complex even with this <code class=\"language-text\">simple</code> function.</p>\n<p>Finally, the <code class=\"language-text\">&quot;be odd&quot;</code> / <code class=\"language-text\">&quot;be even&quot;</code> are used to describe the error in case the expression doesn‚Äôt match:</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6a3bd3cd-cecf-4882-9c69-5afc053f7b88/Untitled.png\" alt=\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6a3bd3cd-cecf-4882-9c69-5afc053f7b88/Untitled.png\"></p>\n<p>Use custom Nimble matchers whenever it improves the readability of your testing code. It needs to feel natural at any step.</p>\n<h1>Conclusion</h1>\n<p>BDD is about tech/business interaction for writing code and defining behavior in a natural and readable way.</p>","frontmatter":{"title":"Starting Quick / BDD in iOS","date":"November 15, 2020","description":"Starting Quick / BDD in iOS"}},"previous":{"fields":{"slug":"/2020-08-19/"},"frontmatter":{"title":"Testing the Untested"}},"next":{"fields":{"slug":"/2020-12-07/"},"frontmatter":{"title":"On abstractions and architecture"}}},"pageContext":{"id":"d84c95cf-5f8b-5711-adc9-8b047faa4291","previousPostId":"b21ff26e-d425-51d4-9882-fd0ca0ea7221","nextPostId":"4ad13dd9-88f4-563a-a82d-39917415a1dd"}},"staticQueryHashes":["2841359383","916993862"]}